# Telegram (optional if TB_NO_TELEGRAM=1)
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=
TELEGRAM_PARSE_MODE=

# Overrides
TB_SYMBOL_OVERRIDE=
TB_LOOKBACK_OVERRIDE=
TB_NO_TELEGRAM=

# Logging
LOG_LEVEL=INFO

# Retention
TB_ARTIFACTS_KEEP=500

# Human digest controls
TB_HUMAN_DIGEST=1
TB_DIGEST_INCLUDE_WEEKLY=1
TB_DIGEST_INCLUDE_ENGINE=1
TB_DIGEST_MAX_TFS=2
TB_DIGEST_DRIFT_WARN_PCT=0.5
TB_DIGEST_TOP_ALTS=ALL
TB_DIGEST_EXPLAIN_HIGH_RISK_ACTION=1

# Telegram gating (defaults safe for dry-run)
TB_NO_TELEGRAM=0
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# Polymarket adapter
TB_ENABLE_POLYMARKET=1
TB_POLYMARKET_SOURCE=pplx
TB_POLYMARKET_ASSETS=BTC,ETH,SOL,XRP
TB_POLYMARKET_MAX_ITEMS=2
TB_POLYMARKET_MIN_LIQUIDITY=1000
# If set to 1, enforce liquidityUSD >= TB_POLYMARKET_MIN_LIQUIDITY. Default 0 (no liquidity gating)
TB_POLYMARKET_REQUIRE_LIQUIDITY=0
TB_POLYMARKET_MIN_QUALITY=0.0
TB_POLYMARKET_MIN_WEEKS=0
TB_POLYMARKET_MAX_WEEKS=52
TB_POLYMARKET_REQUIRE_RESOLUTION=0
TB_POLYMARKET_REQUIRE_ENDDATE=1
TB_POLYMARKET_SHOW_EMPTY=1
TB_POLYMARKET_LIMIT=50
TB_POLYMARKET_TITLE_KEYWORDS=BTC,Bitcoin,ETH,Ethereum,SOL,Solana
TB_POLYMARKET_DEBUG=0
# Limit to near-term markets only (default 30 days window)
TB_POLYMARKET_MAX_WINDOW_DAYS=30
# Enforce end-date windowing and enable today-only fallback (opt-in)
TB_POLYMARKET_ENFORCE_WINDOW=0
# Today-active-only mode: ignore closing window/endDate; require active markets now
TB_POLYMARKET_TODAY_ACTIVE_ONLY=0
# Source selector: native (Polymarket API) or pplx (Perplexity Pro)
TB_POLYMARKET_SOURCE=pplx
TB_POLYMARKET_NUMBERS_IN_CHAT=0
# Show the Outcome line in Telegram for Polymarket (requires NUMBERS_IN_CHAT=1)
TB_POLYMARKET_SHOW_OUTCOME=1
# Standalone digest: force PPLX plain key only and enable native fallback if PPLX returns 0
TB_POLYMARKET_PPLX_USE_PLAIN_ONLY=1
TB_POLYMARKET_FALLBACK_NATIVE=1

# Polymarket internal probability model & debug
TB_POLYMARKET_INTERNAL_ENABLE=1
TB_POLYMARKET_INTERNAL_MODE=bias
TB_POLYMARKET_INTERNAL_BIAS=0.05
TB_POLYMARKET_INTERNAL_ACTION_BIAS=0.08
# Calibration weights and cap
TB_POLY_INT_ALIGN_W=0.2
TB_POLY_INT_READY_W=0.2
TB_POLY_INT_ACTION_W=0.4
TB_POLY_INT_RISK_W=0.2
TB_POLY_INT_MAX_SHIFT=0.2
# Edge label tolerance (default tightened)
TB_POLY_EDGE_TOL=0.02
# Debug logging for Polymarket bridge/provider
TB_POLYMARKET_DEBUG=0

# Perplexity (required if TB_POLYMARKET_SOURCE=pplx)
# For standalone Polymarket digest, prefer a dedicated plain PPLX_API_KEY and set TB_POLYMARKET_PPLX_USE_PLAIN_ONLY=1
# API key rotation (used by universe scans): set PPLX_API_KEY_1..N; provider will rotate per-key with retries
PPLX_API_KEY_1=
PPLX_API_KEY_2=
PPLX_API_KEY_3=
PPLX_API_KEY_4=
# Dedicated single key for Polymarket digest (used exclusively when TB_POLYMARKET_PPLX_USE_PLAIN_ONLY=1)
PPLX_API_KEY=
# Model is enforced to 'sonar' for reliability/cost; PPLX_MODEL is ignored
PPLX_MODEL=sonar
PPLX_TIMEOUT=20
# Backoff between retries for Perplexity API calls (seconds)
TB_PPLX_BACKOFF=0.2
# Perplexity retries and optional prompt override
TB_POLYMARKET_PPLX_RETRIES=2
TB_POLYMARKET_PPLX_PROMPT=

# Discord (optional)
TB_ENABLE_DISCORD=1
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/<id>/<token>
TB_NO_DISCORD=0
# Optional dedicated webhook for Polymarket-only digest
DISCORD_POLYMARKET_WEBHOOK_URL=
# Optional dedicated webhook for Crypto Signals digest
DISCORD_CRYPTO_SIGNALS_WEBHOOK_URL=

# Alpaca (paper trading)
# Keys for paper trading account (NEVER commit real secrets)
ALPACA_API_KEY_ID=
ALPACA_API_SECRET_KEY=
# Paper trading REST endpoint
ALPACA_BASE_URL=https://paper-api.alpaca.markets
# Data endpoint (used by helpers fetching bars/news)
ALPACA_DATA_URL=https://data.alpaca.markets
# Trading safety: set to 1 to disable order placement in any trader scripts
TB_NO_TRADE=1

# Trader defaults / safety gates
TB_TRADER_OFFLINE=1           # preview-only mode (no API calls)
TB_TRADER_TF=1h               # default timeframe for trader
TB_TRADER_RISK_FRAC=0.005     # fraction of equity risked per trade (0.5%)
TB_TRADER_INTERVAL_SEC=60     # loop interval when --loop is enabled
TB_TRADER_COOLDOWN_SEC=900    # per-symbol cooldown to avoid re-entry (15m)
TB_TRADER_MIN_NOTIONAL=10     # enforce minimum order notional (USD quote) for paper trading
TB_TRADER_SYMBOLS=BTC/USD,ETH/USD  # limit trading universe (comma-separated)
TB_TRADER_ENTRY_TOL_BPS=10
TB_TRADER_ENTRY_MID_ZONE=1
TB_TRADER_ORDER_TTL_MIN=30
TB_TRADER_MIN_RR=2.0
# Allow short sells for crypto. Note: Alpaca spot crypto does NOT support shorting.
# When 0 (default), SELLs require existing base position > 0 and the trader will skip SELLs without inventory.
TB_TRADER_ALLOW_SHORTS=0
# Longs-only mode: only place BUYs; for SELLs, require inventory; otherwise suppress SELLs silently to avoid spam
TB_TRADER_LONGS_ONLY=1

# Hybrid trader robustness gates (opt-in)
# ML probability gate
TB_USE_ML_GATE=0
TB_ML_GATE_MODEL_PATH=eval_runs/ml/latest/model.pt
TB_ML_FEATURES_PATH=eval_runs/ml/latest/features.csv
TB_ML_GATE_MIN_PROB=0.50

# ATR volatility filter (15m)
TB_USE_ATR_FILTER=0
TB_ATR_LEN=14
TB_ATR_MIN_PCT=0.002
TB_ATR_MAX_PCT=0.10

# Higher-timeframe regime filter (1h EMA)
TB_USE_HTF_REGIME=0
TB_HTF_EMA_LEN=200

# Heartbeat notifications (when TB_TRADER_NOTIFY=1)
TB_TRADER_NOTIFY_HEARTBEAT=0
TB_HEARTBEAT_EVERY_N=12

# Trader Discord notifications (optional)
# Set TB_TRADER_NOTIFY=1 to enable; provide a dedicated webhook for live-trades channel
TB_TRADER_NOTIFY=0
DISCORD_TRADER_WEBHOOK_URL=

# Hide equities in chat when no live spot provider; artifacts unaffected
TB_DIGEST_HIDE_EQUITIES_IF_NO_DATA=1

# Universe artifact auto-commit/push
TB_UNIVERSE_GIT_AUTOCOMMIT=1
TB_UNIVERSE_GIT_PUSH=1
TB_UNIVERSE_GIT_PUSH_DEFAULT=1

# Evaluation runs auto-commit/push (eval_runner)
# When enabled, eval CSV outputs under eval_runs/<ts>/ will be staged, committed, and pushed.
# Optionally include eval_data/resolved source CSVs in the same commit.
TB_EVAL_GIT_AUTOCOMMIT=1
TB_EVAL_GIT_PUSH=1
TB_EVAL_GIT_INCLUDE_DATA=0

# Polymarket digest docs auto-commit/push (polymarket_digest_send.py)
# When enabled, polymarket_digest.md will be staged, committed, and pushed after each run.
TB_AUTOCOMMIT_DOCS=1

# Confidence display (opt-in)
# Show internal/model confidence for Polymarket items in chat (percent)
TB_POLYMARKET_SHOW_CONFIDENCE=0
# Show agent-estimated confidence for asset blocks in chat (percent)
TB_SHOW_ASSET_CONFIDENCE_IN_CHAT=0

# Setup grading tunables
# Weights for overall grade calculation
TB_GRADE_W_CONF=0.45
TB_GRADE_W_CONFCHK=0.35
TB_GRADE_W_ALIGN=0.20
# Grade thresholds (map weighted score to letter grades)
TB_GRADE_THRESH_A=0.85
TB_GRADE_THRESH_B=0.70
TB_GRADE_THRESH_C=0.55

# Underrated scanner (Perplexity + enrichment)
# Run interval guard (days); default 7 to avoid spam
TB_UNDERRATED_RUN_INTERVAL_DAYS=7
# Market cap threshold (USD); only alert if <= threshold
TB_UNDERRATED_MARKETCAP_THRESHOLD=10000000
# Alert channel gating (set to 0 to disable)
TB_UNDERRATED_ALERT_DISCORD=1
TB_UNDERRATED_ALERT_TELEGRAM=1
# Optional dedicated Discord webhook for underrated alerts; otherwise uses DISCORD_CRYPTO_SIGNALS_WEBHOOK_URL or DISCORD_WEBHOOK_URL
DISCORD_UNDERRATED_WEBHOOK_URL=
# Persistence store and outputs directory
TB_UNDERRATED_STORE=data/underrated_store.json
TB_UNDERRATED_OUTDIR=underrated_runs
# Auto-commit/push underrated artifacts (JSON/MD under underrated_runs/ and data/underrated_store.json). Scripts are never committed.
TB_UNDERRATED_GIT_AUTOCOMMIT=1
TB_UNDERRATED_GIT_PUSH=1
# Perplexity discovery tuning (recency window in hours; top-N selection; force/dedupe behavior)
TB_UNDERRATED_PPLX_HOURS=72
TB_UNDERRATED_TOP_N=20
# When 1, include top-N even if previously alerted (one-off bulk discovery)
TB_UNDERRATED_FORCE_ALERTS=0
# When 1, re-include a previously alerted project only if its recent signal is within the recency window
TB_UNDERRATED_REINCLUDE_RECENT=1
# When 1, strictly require recent_date within the PPLX hours window for inclusion
TB_UNDERRATED_REQUIRE_RECENT=0
# External APIs (optional: override endpoints)
TB_COINGECKO_API=https://api.coingecko.com/api/v3
